var TcHmi;!function(TcHmi){!function(Controls){!function(Helpers){Helpers.Popup=class{constructor(__parentControl){this.__parentControl=__parentControl,this.__childControls=[],this.__destroyers=[],this.__prompt=null,this.__isShowing=!1,this.__className="TcHmi_Controls_Helpers_Popup",this.__localizationSymbols=new Map,this.__name=`${this.__parentControl.getId()}.${this.constructor.name}-${tchmi_create_guid()}`;const controlClass=this.__parentControl.getType().replace(/\./g,"_");this.__element=document.createElement("div"),this.__element.classList.add(this.__className,`${this.__className}-${this.constructor.name}`,controlClass+"-popup"),this.__elementHeader=document.createElement("h1"),this.__element.appendChild(this.__elementHeader),this.__elementContent=document.createElement("div"),this.__elementContent.classList.add(this.__className+"-content"),this.__element.appendChild(this.__elementContent),this.__elementFooter=document.createElement("div"),this.__elementFooter.classList.add(this.__className+"-footer"),this.__element.appendChild(this.__elementFooter)}show(){this.__isShowing||(TcHmi.TopMostLayer.add(this.__parentControl,$(this.__element),{removeCb:()=>{this.__isShowing=!1,this.hide()},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(TcHmi.TopMostLayer.remove(this.__parentControl,$(this.__element)),this.__isShowing=!1)}async prompt(){var _a;return null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Popup was prompted again without the previous prompt having been resolved.")),this.show(),new Promise((resolve,reject)=>{this.__prompt={answer:value=>{resolve(value),this.__prompt=null,this.hide()},error:value=>{reject(value),this.__prompt=null,this.hide()}}})}destroy(force=!1){for(const destroy of this.__destroyers)destroy();this.__destroyers=[];for(const control of this.__childControls)force&&this.__parentControl.__removeChild(control),control.destroy();this.__childControls=[];for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear()}isShowing(){return this.__isShowing}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);null==existing||existing.destroyWatch(),null==existing||existing.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbol),destroyWatch=symbol.watch(data=>{var _a;if(data.error!==TcHmi.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=${localization.symbol}] `+TcHmi.Log.buildMessage(data.details)));let text=null!==(_a=data.value)&&void 0!==_a?_a:"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}}}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class TextAndButtonsPrompt extends Helpers.Popup{constructor(buttons,parentControl){super(parentControl),this.__buttons=new Map,this.__localizationSymbols=new Map;for(const[name,buttonDef]of Object.entries(buttons)){if(!buttonDef)continue;let button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${name}`,buttonDef.attributes,this.__parentControl);if(!button)throw new Error("Could not create controls for TextAndButtonsPrompt.");this.__elementFooter.appendChild(button.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(button.getId()+".onPressed",this.__createPressedHandler(buttonDef.value))),this.__buttons.set(name,{value:buttonDef.value,button:button}),this.__childControls.push(button)}}__createPressedHandler(value){return()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&(this.__prompt?this.__prompt.answer(value):this.hide())}}getButtons(){return this.__buttons}setLocalizations(texts){texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=tchmi_decode_control_characters(text)),texts.contentText&&this.__watchLocalization("contentText","string"==typeof texts.contentText?{symbol:texts.contentText,formatValues:[]}:texts.contentText,text=>this.__elementContent.textContent=tchmi_decode_control_characters(text))}}Helpers.TextAndButtonsPrompt=TextAndButtonsPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class OkCancelPrompt extends Helpers.Popup{constructor(parentControl){super(parentControl),this.__onOkPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__ok()},this.__onCancelPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__cancel()};let okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".okButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".cancelButton",{"data-tchmi-width":60,"data-tchmi-height":30},this.__parentControl);if(!okButton||!cancelButton)throw new Error("Could not create controls for OkCancelPrompt.");this.__elementFooter.appendChild(okButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",this.__onOkPressed)),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",this.__onCancelPressed)),this.__okButton=okButton,this.__cancelButton=cancelButton,this.__childControls.push(okButton,cancelButton)}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Text",this.__okButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__okButton),TcHmi.Binding.removeEx2(null,"Text",this.__cancelButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__okButton),super.destroy(force)}__cancel(){var _a;null===(_a=this.__prompt)||void 0===_a||_a.answer({isOk:!1})}setLocalizations(texts){texts.buttonTextOk&&("string"==typeof texts.buttonTextOk?TcHmi.Binding.createEx2(texts.buttonTextOk,"Text",this.__okButton):this.__watchLocalization("buttonTextOk",texts.buttonTextOk,text=>this.__okButton.setText(text))),texts.buttonTooltipOk&&("string"==typeof texts.buttonTooltipOk?TcHmi.Binding.createEx2(texts.buttonTooltipOk,"Tooltip",this.__okButton):this.__watchLocalization("buttonTooltipOk",texts.buttonTooltipOk,text=>this.__okButton.setTooltip(text))),texts.buttonTextCancel&&("string"==typeof texts.buttonTextCancel?TcHmi.Binding.createEx2(texts.buttonTextCancel,"Text",this.__cancelButton):this.__watchLocalization("buttonTextCancel",texts.buttonTextCancel,text=>this.__cancelButton.setText(text))),texts.buttonTooltipCancel&&("string"==typeof texts.buttonTooltipCancel?TcHmi.Binding.createEx2(texts.buttonTooltipCancel,"Tooltip",this.__cancelButton):this.__watchLocalization("buttonTooltipCancel",texts.buttonTooltipCancel,text=>this.__cancelButton.setTooltip(text)))}}Helpers.OkCancelPrompt=OkCancelPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class InputPrompt extends Helpers.OkCancelPrompt{constructor(parentControl){super(parentControl),this.__forbiddenValues=new Set,this.__validationPatterns=[],this.__onTextChanged=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__validate()},this.__onKeydown=e=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&"Enter"===e.key&&this.__ok()},this.__elementLabel=document.createElement("span"),this.__elementLabel.className=this.__className+"-label",this.__elementContent.appendChild(this.__elementLabel);let input=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",this.__name+".input",{"data-tchmi-width":300,"data-tchmi-height":26,"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!input)throw new Error("Could not create controls for InputPrompt.");this.__input=input,this.__childControls.push(input);let inputElement=input.getElement()[0];inputElement.classList.add("with-validation"),this.__elementContent.appendChild(inputElement),this.__destroyers.push(TcHmi.EventProvider.register(input.getId()+".onTextChanged",this.__onTextChanged)),this.__element.addEventListener("keydown",this.__onKeydown),this.__destroyers.push(()=>this.__element.removeEventListener("keydown",this.__onKeydown))}__validate(){const text=this.__input.getText(),isValid=void 0!==text&&this.__isValid(text);this.__okButton.setIsEnabled(isValid),this.__input.getElement()[0].classList.toggle("invalid",!isValid)}__isValid(text){return!this.__forbiddenValues.has(text)&&this.__validationPatterns.every(validation=>validation.pattern.test(text)===validation.expectedTestResult)}__ok(){var _a,_b;let text=this.__input.getText();void 0!==text&&this.__isValid(text)?null===(_b=this.__prompt)||void 0===_b||_b.answer({isOk:!0,value:text}):null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Invalid input."))}async prompt(forbiddenValues=null,defaultValue=""){this.__forbiddenValues=new Set(forbiddenValues),this.__input.setText(defaultValue);let input=this.__input.getElement()[0].querySelector("input");return input instanceof HTMLInputElement&&(input.selectionDirection="forward",input.selectionStart=0,input.selectionEnd=input.value.length),super.prompt()}show(){super.show();let input=this.__input.getElement()[0].querySelector("input");input instanceof HTMLInputElement&&input.focus()}setValidationPatterns(patterns){this.__validationPatterns=patterns,this.__validate()}getValidationPatterns(){return this.__validationPatterns}setLocalizations(texts){super.setLocalizations(texts),texts.labelText&&this.__watchLocalization("labelText","string"==typeof texts.labelText?{symbol:texts.labelText,formatValues:[]}:texts.labelText,text=>this.__elementLabel.textContent=tchmi_decode_control_characters(text)),texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=tchmi_decode_control_characters(text))}}Helpers.InputPrompt=InputPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));